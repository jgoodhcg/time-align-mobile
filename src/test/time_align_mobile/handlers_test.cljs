(ns time-align-mobile.handlers-test
  (:require [time-align-mobile.handlers :as handlers]
            [time-align-mobile.helpers :refer [deep-merge]]
            [time-align-mobile.db :as db :refer [app-db]]))

(js/test "example test"
         #(-> (str "x")
              (js/expect)
              (.toBe "x")))

(js/test "handler select-element-edit generated test"
         #(-> (handlers/select-element-edit
               {:db {:active-filter     nil,
                                                  :time-navigators   {:day      #inst "2019-10-03T22:52:24.445-00:00",
                                                                      :calendar #inst "2019-10-03T22:52:24.445-00:00",
                                                                      :report   #inst "2019-10-03T22:52:24.445-00:00"},
                                                  :now               #inst "2019-10-03T22:53:24.602-00:00",
                                                  :config            {:auto-log-time-align   true,
                                                                      :pixel-to-minute-ratio {:default 0.5,
                                                                                              :current 0.5}},
                                                  :filters           [{:id          #uuid "bbc34081-38d4-4d4f-ab19-a7cef18c1212",
                                                                       :label       "sort by bucket label",
                                                                       :created     #inst "2019-10-03T22:52:24.445-00:00",
                                                                       :compatible  [:period :template],
                                                                       :last-edited #inst "2019-10-03T22:52:24.445-00:00",
                                                                       :sort        {:path      [:bucket-label],
                                                                                     :ascending true},
                                                                       :predicates  []} {:id          #uuid "aad94081-38d4-4d4f-ab19-a7cef18c1299",
                                                                                         :label       "sort by label",
                                                                                         :created     #inst "2019-10-03T22:52:24.445-00:00",
                                                                                         :compatible  [:bucket :filter :period :template],
                                                                                         :last-edited #inst "2019-10-03T22:52:24.445-00:00",
                                                                                         :sort        {:path      [:label],
                                                                                                       :ascending true},
                                                                                         :predicates  []} {:id          #uuid "cccc4081-38d4-4d4f-ab19-a7cef18c4444",
                                                                                                           :label       "time align bucket filter",
                                                                                                           :created     #inst "2019-10-03T22:52:24.445-00:00",
                                                                                                           :compatible  [:period :template],
                                                                                                           :last-edited #inst "2019-10-03T22:52:24.445-00:00",
                                                                                                           :sort        nil,
                                                                                                           :predicates  [{:path   [:bucket-id],
                                                                                                                          :value  "a7396f81-38d4-4d4f-ab19-a7cef18c4ea2",
                                                                                                                          :negate false}]} {:id          #uuid "79d85cf3-b664-42c0-b8cf-2dc4fa9f520a",
                                                                                                                                            :label       "new bucket bucket filter",
                                                                                                                                            :created     #inst "2019-10-03T22:53:01.384-00:00",
                                                                                                                                            :last-edited #inst "2019-10-03T22:53:01.384-00:00",
                                                                                                                                            :compatible  [:period :template],
                                                                                                                                            :sort        {:path      [:start],
                                                                                                                                                          :ascending true},
                                                                                                                                            :predicates  [{:path   [:bucket-id],
                                                                                                                                                           :negate false,
                                                                                                                                                           :value  "3e5fb39c-ec07-4660-8b3b-95acaedd2b6f"}]}],
                                                  :patterns          [{:id          #uuid "ffa49881-38d4-4d4f-ab19-a7cef18c4465",
                                                                       :label       "an example pattern",
                                                                       :created     #inst "2019-10-03T22:52:24.445-00:00",
                                                                       :last-edited #inst "2019-10-03T22:53:32.936-00:00",
                                                                       :data        {},
                                                                       :templates   [{:planned     true,
                                                                                      :start       36504239,
                                                                                      :created     #inst "2019-10-03T22:53:31.183-00:00",
                                                                                      :stop        40104239,
                                                                                      :label       "",
                                                                                      :id          #uuid "2c1c193c-51c9-4b0c-a849-34f1387cea7e",
                                                                                      :last-edited #inst "2019-10-03T22:53:31.183-00:00",
                                                                                      :bucket-id   #uuid "3e5fb39c-ec07-4660-8b3b-95acaedd2b6f",
                                                                                      :data        {}}]}],
                                                  :navigation        {:current-screen :pattern-planning,
                                                                      :params         {:do-not-load-form true}},
                                                  :period-in-play-id nil,
                                                  :buckets           {#uuid "3e5fb39c-ec07-4660-8b3b-95acaedd2b6f" {:id          #uuid "3e5fb39c-ec07-4660-8b3b-95acaedd2b6f",
                                                                                                                    :label       "new bucket",
                                                                                                                    :created     #inst "2019-10-03T22:52:53.711-00:00",
                                                                                                                    :last-edited #inst "2019-10-03T22:52:59.719-00:00",
                                                                                                                    :data        {},
                                                                                                                    :color       "#ff1122",
                                                                                                                    :templates   nil,
                                                                                                                    :periods     {#uuid "49f088d0-23bc-45c6-a30a-c53bcae5d41a" {:id          #uuid "49f088d0-23bc-45c6-a30a-c53bcae5d41a",
                                                                                                                                                                                :created     #inst "2019-10-03T22:53:10.372-00:00",
                                                                                                                                                                                :last-edited #inst "2019-10-03T22:53:10.372-00:00",
                                                                                                                                                                                :label       "",
                                                                                                                                                                                :planned     false,
                                                                                                                                                                                :start       #inst "2019-10-03T13:33:03.723-00:00",
                                                                                                                                                                                :stop        #inst "2019-10-03T14:18:03.723-00:00",
                                                                                                                                                                                :data        {}}}}},
                                                  :selection         {:period   {:movement {:bucket-id nil,
                                                                                            :period-id nil},
                                                                                 :edit     {:bucket-id nil,
                                                                                            :period-id nil}},
                                                                      :template {:movement {:bucket-id   nil,
                                                                                            :template-id nil},
                                                                                 :edit     {:bucket-id   nil,
                                                                                            :template-id nil}}},
                                                  :forms             {:bucket-form   {:id          #uuid "3e5fb39c-ec07-4660-8b3b-95acaedd2b6f",
                                                                                      :label       "new bucket",
                                                                                      :created     #inst "2019-10-03T22:52:53.711-00:00",
                                                                                      :last-edited #inst "2019-10-03T22:52:59.719-00:00",
                                                                                      :data        "{}",
                                                                                      :color       "#ff1122",
                                                                                      :templates   nil,
                                                                                      :periods     nil},
                                                                      :period-form   {:planned      false,
                                                                                      :bucket-label "new bucket",
                                                                                      :start        #inst "2019-10-03T13:33:03.723-00:00",
                                                                                      :created      #inst "2019-10-03T22:53:10.372-00:00",
                                                                                      :stop         #inst "2019-10-03T14:18:03.723-00:00",
                                                                                      :label        "",
                                                                                      :id           #uuid "49f088d0-23bc-45c6-a30a-c53bcae5d41a",
                                                                                      :last-edited  #inst "2019-10-03T22:53:10.372-00:00",
                                                                                      :bucket-id    #uuid "3e5fb39c-ec07-4660-8b3b-95acaedd2b6f",
                                                                                      :bucket-color "#ff1122",
                                                                                      :data         "{}"},
                                                                      :pattern-form  {:id          #uuid "ffa49881-38d4-4d4f-ab19-a7cef18c4465",
                                                                                      :label       "an example pattern",
                                                                                      :created     #inst "2019-10-03T22:52:24.445-00:00",
                                                                                      :last-edited #inst "2019-10-03T22:53:32.936-00:00",
                                                                                      :data        "{}",
                                                                                      :templates   [{:planned     true,
                                                                                                     :start       36504239,
                                                                                                     :created     #inst "2019-10-03T22:53:31.183-00:00",
                                                                                                     :stop        40104239,
                                                                                                     :label       "",
                                                                                                     :id          #uuid "2c1c193c-51c9-4b0c-a849-34f1387cea7e",
                                                                                                     :last-edited #inst "2019-10-03T22:53:31.183-00:00",
                                                                                                     :bucket-id   #uuid "3e5fb39c-ec07-4660-8b3b-95acaedd2b6f",
                                                                                                     :data        {}}]},
                                                                      :template-form nil,
                                                                      :filter-form   nil},
                                                  :selected-template nil}}
               [:select-element-edit
                {:element-type :template,
                                     :bucket-id    #uuid "3e5fb39c-ec07-4660-8b3b-95acaedd2b6f",
                                     :element-id   #uuid "2c1c193c-51c9-4b0c-a849-34f1387cea7e"}])
              (str)
              (js/expect)
              (.toBe (str {:db       {:active-filter     nil,
                                      :time-navigators   {:day      #inst "2019-10-03T22:52:24.445-00:00",
                                                          :calendar #inst "2019-10-03T22:52:24.445-00:00",
                                                          :report   #inst "2019-10-03T22:52:24.445-00:00"},
                                      :now               #inst "2019-10-03T22:53:24.602-00:00",
                                      :config            {:auto-log-time-align   true,
                                                          :pixel-to-minute-ratio {:default 0.5,
                                                                                  :current 0.5}},
                                      :filters           [{:id          #uuid "bbc34081-38d4-4d4f-ab19-a7cef18c1212",
                                                           :label       "sort by bucket label",
                                                           :created     #inst "2019-10-03T22:52:24.445-00:00",
                                                           :compatible  [:period :template],
                                                           :last-edited #inst "2019-10-03T22:52:24.445-00:00",
                                                           :sort        {:path      [:bucket-label],
                                                                         :ascending true},
                                                           :predicates  []} {:id          #uuid "aad94081-38d4-4d4f-ab19-a7cef18c1299",
                                                                             :label       "sort by label",
                                                                             :created     #inst "2019-10-03T22:52:24.445-00:00",
                                                                             :compatible  [:bucket :filter :period :template],
                                                                             :last-edited #inst "2019-10-03T22:52:24.445-00:00",
                                                                             :sort        {:path      [:label],
                                                                                           :ascending true},
                                                                             :predicates  []} {:id          #uuid "cccc4081-38d4-4d4f-ab19-a7cef18c4444",
                                                                                               :label       "time align bucket filter",
                                                                                               :created     #inst "2019-10-03T22:52:24.445-00:00",
                                                                                               :compatible  [:period :template],
                                                                                               :last-edited #inst "2019-10-03T22:52:24.445-00:00",
                                                                                               :sort        nil,
                                                                                               :predicates  [{:path   [:bucket-id],
                                                                                                              :value  "a7396f81-38d4-4d4f-ab19-a7cef18c4ea2",
                                                                                                              :negate false}]} {:id          #uuid "79d85cf3-b664-42c0-b8cf-2dc4fa9f520a",
                                                                                                                                :label       "new bucket bucket filter",
                                                                                                                                :created     #inst "2019-10-03T22:53:01.384-00:00",
                                                                                                                                :last-edited #inst "2019-10-03T22:53:01.384-00:00",
                                                                                                                                :compatible  [:period :template],
                                                                                                                                :sort        {:path      [:start],
                                                                                                                                              :ascending true},
                                                                                                                                :predicates  [{:path   [:bucket-id],
                                                                                                                                               :negate false,
                                                                                                                                               :value  "3e5fb39c-ec07-4660-8b3b-95acaedd2b6f"}]}],
                                      :patterns          [{:id          #uuid "ffa49881-38d4-4d4f-ab19-a7cef18c4465",
                                                           :label       "an example pattern",
                                                           :created     #inst "2019-10-03T22:52:24.445-00:00",
                                                           :last-edited #inst "2019-10-03T22:53:32.936-00:00",
                                                           :data        {},
                                                           :templates   [{:planned     true,
                                                                          :start       36504239,
                                                                          :created     #inst "2019-10-03T22:53:31.183-00:00",
                                                                          :stop        40104239,
                                                                          :label       "",
                                                                          :id          #uuid "2c1c193c-51c9-4b0c-a849-34f1387cea7e",
                                                                          :last-edited #inst "2019-10-03T22:53:31.183-00:00",
                                                                          :bucket-id   #uuid "3e5fb39c-ec07-4660-8b3b-95acaedd2b6f",
                                                                          :data        {}}]}],
                                      :navigation        {:current-screen :pattern-planning,
                                                          :params         {:do-not-load-form true}},
                                      :period-in-play-id nil,
                                      :buckets           {#uuid "3e5fb39c-ec07-4660-8b3b-95acaedd2b6f" {:id          #uuid "3e5fb39c-ec07-4660-8b3b-95acaedd2b6f",
                                                                                                        :label       "new bucket",
                                                                                                        :created     #inst "2019-10-03T22:52:53.711-00:00",
                                                                                                        :last-edited #inst "2019-10-03T22:52:59.719-00:00",
                                                                                                        :data        {},
                                                                                                        :color       "#ff1122",
                                                                                                        :templates   nil,
                                                                                                        :periods     {#uuid "49f088d0-23bc-45c6-a30a-c53bcae5d41a" {:id          #uuid "49f088d0-23bc-45c6-a30a-c53bcae5d41a",
                                                                                                                                                                    :created     #inst "2019-10-03T22:53:10.372-00:00",
                                                                                                                                                                    :last-edited #inst "2019-10-03T22:53:10.372-00:00",
                                                                                                                                                                    :label       "",
                                                                                                                                                                    :planned     false,
                                                                                                                                                                    :start       #inst "2019-10-03T13:33:03.723-00:00",
                                                                                                                                                                    :stop        #inst "2019-10-03T14:18:03.723-00:00",
                                                                                                                                                                    :data        {}}}}},
                                      :selection         {:period   {:movement {:bucket-id nil,
                                                                                :period-id nil},
                                                                     :edit     {:bucket-id nil,
                                                                                :period-id nil}},
                                                          :template {:movement {:bucket-id   nil,
                                                                                :template-id nil},
                                                                     :edit     {:template-id #uuid "2c1c193c-51c9-4b0c-a849-34f1387cea7e",
                                                                                :bucket-id   #uuid "3e5fb39c-ec07-4660-8b3b-95acaedd2b6f"}}},
                                      :forms             {:bucket-form   {:id          #uuid "3e5fb39c-ec07-4660-8b3b-95acaedd2b6f",
                                                                          :label       "new bucket",
                                                                          :created     #inst "2019-10-03T22:52:53.711-00:00",
                                                                          :last-edited #inst "2019-10-03T22:52:59.719-00:00",
                                                                          :data        "{}",
                                                                          :color       "#ff1122",
                                                                          :templates   nil,
                                                                          :periods     nil},
                                                          :period-form   {:planned      false,
                                                                          :bucket-label "new bucket",
                                                                          :start        #inst "2019-10-03T13:33:03.723-00:00",
                                                                          :created      #inst "2019-10-03T22:53:10.372-00:00",
                                                                          :stop         #inst "2019-10-03T14:18:03.723-00:00",
                                                                          :label        "",
                                                                          :id           #uuid "49f088d0-23bc-45c6-a30a-c53bcae5d41a",
                                                                          :last-edited  #inst "2019-10-03T22:53:10.372-00:00",
                                                                          :bucket-id    #uuid "3e5fb39c-ec07-4660-8b3b-95acaedd2b6f",
                                                                          :bucket-color "#ff1122",
                                                                          :data         "{}"},
                                                          :pattern-form  {:id          #uuid "ffa49881-38d4-4d4f-ab19-a7cef18c4465",
                                                                          :label       "an example pattern",
                                                                          :created     #inst "2019-10-03T22:52:24.445-00:00",
                                                                          :last-edited #inst "2019-10-03T22:53:32.936-00:00",
                                                                          :data        "{}",
                                                                          :templates   [{:planned     true,
                                                                                         :start       36504239,
                                                                                         :created     #inst "2019-10-03T22:53:31.183-00:00",
                                                                                         :stop        40104239,
                                                                                         :label       "",
                                                                                         :id          #uuid "2c1c193c-51c9-4b0c-a849-34f1387cea7e",
                                                                                         :last-edited #inst "2019-10-03T22:53:31.183-00:00",
                                                                                         :bucket-id   #uuid "3e5fb39c-ec07-4660-8b3b-95acaedd2b6f",
                                                                                         :data        {}}]},
                                                          :template-form nil,
                                                          :filter-form   nil},
                                      :selected-template nil},
                           :dispatch [:load-template-form-from-pattern-planning #uuid "2c1c193c-51c9-4b0c-a849-34f1387cea7e"]}))))

(js/test "handler select-element-edit generated test with diff" #(-> (handlers/select-element-edit {:db (deep-merge app-db {:forms {:pattern-form {:id #uuid "ffa49881-38d4-4d4f-ab19-a7cef18c4465", :label "an example pattern", :created #inst "2019-10-03T22:52:24.445-00:00", :last-edited #inst "2019-10-03T22:53:32.936-00:00", :data "{}", :templates [{:planned true, :start 36504239, :created #inst "2019-10-03T22:53:31.183-00:00", :stop 40104239, :label "", :id #uuid "2c1c193c-51c9-4b0c-a849-34f1387cea7e", :last-edited #inst "2019-10-03T22:53:31.183-00:00", :bucket-id #uuid "3e5fb39c-ec07-4660-8b3b-95acaedd2b6f", :data {}}]}, :period-form {:planned false, :bucket-label "new bucket", :start #inst "2019-10-03T13:33:03.723-00:00", :created #inst "2019-10-03T22:53:10.372-00:00", :stop #inst "2019-10-03T14:18:03.723-00:00", :label "", :id #uuid "49f088d0-23bc-45c6-a30a-c53bcae5d41a", :last-edited #inst "2019-10-03T22:53:10.372-00:00", :bucket-id #uuid "3e5fb39c-ec07-4660-8b3b-95acaedd2b6f", :bucket-color "#ff1122", :data "{}"}, :bucket-form {:id #uuid "3e5fb39c-ec07-4660-8b3b-95acaedd2b6f", :label "new bucket", :created #inst "2019-10-03T22:52:53.711-00:00", :last-edited #inst "2019-10-03T22:52:59.719-00:00", :data "{}", :color "#ff1122", :templates nil, :periods nil}}, :buckets {#uuid "3e5fb39c-ec07-4660-8b3b-95acaedd2b6f" {:id #uuid "3e5fb39c-ec07-4660-8b3b-95acaedd2b6f", :label "new bucket", :created #inst "2019-10-03T22:52:53.711-00:00", :last-edited #inst "2019-10-03T22:52:59.719-00:00", :data {}, :color "#ff1122", :templates nil, :periods {#uuid "49f088d0-23bc-45c6-a30a-c53bcae5d41a" {:id #uuid "49f088d0-23bc-45c6-a30a-c53bcae5d41a", :created #inst "2019-10-03T22:53:10.372-00:00", :last-edited #inst "2019-10-03T22:53:10.372-00:00", :label "", :planned false, :start #inst "2019-10-03T13:33:03.723-00:00", :stop #inst "2019-10-03T14:18:03.723-00:00", :data {}}}}}, :navigation {:params {:do-not-load-form true}, :current-screen :pattern-planning}, :patterns [{:templates [{:planned true, :start 36504239, :created #inst "2019-10-03T22:53:31.183-00:00", :stop 40104239, :label "", :id #uuid "2c1c193c-51c9-4b0c-a849-34f1387cea7e", :last-edited #inst "2019-10-03T22:53:31.183-00:00", :bucket-id #uuid "3e5fb39c-ec07-4660-8b3b-95acaedd2b6f", :data {}}], :last-edited #inst "2019-10-03T22:53:32.936-00:00", :created #inst "2019-10-03T22:52:24.445-00:00"}], :filters [{:last-edited #inst "2019-10-03T22:52:24.445-00:00", :created #inst "2019-10-03T22:52:24.445-00:00"} {:last-edited #inst "2019-10-03T22:52:24.445-00:00", :created #inst "2019-10-03T22:52:24.445-00:00"} {:last-edited #inst "2019-10-03T22:52:24.445-00:00", :created #inst "2019-10-03T22:52:24.445-00:00"} {:id #uuid "79d85cf3-b664-42c0-b8cf-2dc4fa9f520a", :label "new bucket bucket filter", :created #inst "2019-10-03T22:53:01.384-00:00", :last-edited #inst "2019-10-03T22:53:01.384-00:00", :compatible [:period :template], :sort {:path [:start], :ascending true}, :predicates [{:path [:bucket-id], :negate false, :value "3e5fb39c-ec07-4660-8b3b-95acaedd2b6f"}]}], :now #inst "2019-10-03T22:53:24.602-00:00", :time-navigators {:report #inst "2019-10-03T22:52:24.445-00:00", :calendar #inst "2019-10-03T22:52:24.445-00:00", :day #inst "2019-10-03T22:52:24.445-00:00"}, :selected-template nil})}[:select-element-edit {:element-type :template, :bucket-id #uuid "3e5fb39c-ec07-4660-8b3b-95acaedd2b6f", :element-id #uuid "2c1c193c-51c9-4b0c-a849-34f1387cea7e"}])((fn [m] (into (sorted-map) m)))(str) (js/expect) (.toBe (->> {:time-navigators {:report #inst "2019-10-03T22:52:24.445-00:00", :calendar #inst "2019-10-03T22:52:24.445-00:00", :day #inst "2019-10-03T22:52:24.445-00:00"}, :now #inst "2019-10-03T22:53:24.602-00:00", :filters [{:last-edited #inst "2019-10-03T22:52:24.445-00:00", :created #inst "2019-10-03T22:52:24.445-00:00"} {:last-edited #inst "2019-10-03T22:52:24.445-00:00", :created #inst "2019-10-03T22:52:24.445-00:00"} {:last-edited #inst "2019-10-03T22:52:24.445-00:00", :created #inst "2019-10-03T22:52:24.445-00:00"} {:id #uuid "79d85cf3-b664-42c0-b8cf-2dc4fa9f520a", :label "new bucket bucket filter", :created #inst "2019-10-03T22:53:01.384-00:00", :last-edited #inst "2019-10-03T22:53:01.384-00:00", :compatible [:period :template], :sort {:path [:start], :ascending true}, :predicates [{:path [:bucket-id], :negate false, :value "3e5fb39c-ec07-4660-8b3b-95acaedd2b6f"}]}], :patterns [{:templates [{:planned true, :start 36504239, :created #inst "2019-10-03T22:53:31.183-00:00", :stop 40104239, :label "", :id #uuid "2c1c193c-51c9-4b0c-a849-34f1387cea7e", :last-edited #inst "2019-10-03T22:53:31.183-00:00", :bucket-id #uuid "3e5fb39c-ec07-4660-8b3b-95acaedd2b6f", :data {}}], :last-edited #inst "2019-10-03T22:53:32.936-00:00", :created #inst "2019-10-03T22:52:24.445-00:00"}], :navigation {:params {:do-not-load-form true}, :current-screen :pattern-planning}, :buckets {#uuid "3e5fb39c-ec07-4660-8b3b-95acaedd2b6f" {:id #uuid "3e5fb39c-ec07-4660-8b3b-95acaedd2b6f", :label "new bucket", :created #inst "2019-10-03T22:52:53.711-00:00", :last-edited #inst "2019-10-03T22:52:59.719-00:00", :data {}, :color "#ff1122", :templates nil, :periods {#uuid "49f088d0-23bc-45c6-a30a-c53bcae5d41a" {:id #uuid "49f088d0-23bc-45c6-a30a-c53bcae5d41a", :created #inst "2019-10-03T22:53:10.372-00:00", :last-edited #inst "2019-10-03T22:53:10.372-00:00", :label "", :planned false, :start #inst "2019-10-03T13:33:03.723-00:00", :stop #inst "2019-10-03T14:18:03.723-00:00", :data {}}}}}, :selection {:template {:edit {:template-id #uuid "2c1c193c-51c9-4b0c-a849-34f1387cea7e", :bucket-id #uuid "3e5fb39c-ec07-4660-8b3b-95acaedd2b6f"}}}, :forms {:pattern-form {:id #uuid "ffa49881-38d4-4d4f-ab19-a7cef18c4465", :label "an example pattern", :created #inst "2019-10-03T22:52:24.445-00:00", :last-edited #inst "2019-10-03T22:53:32.936-00:00", :data "{}", :templates [{:planned true, :start 36504239, :created #inst "2019-10-03T22:53:31.183-00:00", :stop 40104239, :label "", :id #uuid "2c1c193c-51c9-4b0c-a849-34f1387cea7e", :last-edited #inst "2019-10-03T22:53:31.183-00:00", :bucket-id #uuid "3e5fb39c-ec07-4660-8b3b-95acaedd2b6f", :data {}}]}, :period-form {:planned false, :bucket-label "new bucket", :start #inst "2019-10-03T13:33:03.723-00:00", :created #inst "2019-10-03T22:53:10.372-00:00", :stop #inst "2019-10-03T14:18:03.723-00:00", :label "", :id #uuid "49f088d0-23bc-45c6-a30a-c53bcae5d41a", :last-edited #inst "2019-10-03T22:53:10.372-00:00", :bucket-id #uuid "3e5fb39c-ec07-4660-8b3b-95acaedd2b6f", :bucket-color "#ff1122", :data "{}"}, :bucket-form {:id #uuid "3e5fb39c-ec07-4660-8b3b-95acaedd2b6f", :label "new bucket", :created #inst "2019-10-03T22:52:53.711-00:00", :last-edited #inst "2019-10-03T22:52:59.719-00:00", :data "{}", :color "#ff1122", :templates nil, :periods nil}}, :selected-template nil}(deep-merge app-db)((fn [db] {:db db}))(merge {:dispatch [:load-template-form-from-pattern-planning #uuid "2c1c193c-51c9-4b0c-a849-34f1387cea7e"]})(into (sorted-map))(str)))))
